var express = require('express');
var manager = require('./FileManager');
var cm = require('./CouchManager');
var re = require('./rendering');
var cfgManager = require('./configurationManager');
var fs = require('fs');

//load documents from ../html
var loader = new manager.DocumentLoader('../html');
loader.Load();

cfgManager.ConfigManager.ReadConfig();

console.log(cfgManager);

var cfg = cfgManager.ConfigManager.cfg;


//create couchdb interface
var client = new cm.Manager(cfg.couchDB.port, cfg.couchDB.host, cfg.couchDB.dbname);

//webserver
var app = express.createServer();

app.configure(function()
{
	app.use(express.bodyParser());
});

app.get('/', function(req, res)
{
	var index = loader.Files['index.html'];
	client.GetLists('lists', function(data)
	{
		console.log(data);
		res.send(index.toString());
	});
});

app.post('/NewList', function(req, res)
{
	console.log(req.body);
});

app.get('/heading.gif', function(req, res)
{
	res.setHeader('Content-Type', 'image/gif');
	res.send(loader.Files['heading.gif']);
});

app.get('/style.css', function(req, res)
{
	res.setHeader('Content-Type', 'text/css');
	res.send(loader.Files['style.css']);
});

app.get('/custom.js', function(req, res)
{
	res.setHeader('Content-Type', 'text/javascript');
	res.send(loader.Files['custom.js']);
});

app.get('/jquery.js', function(req, res)
{
	res.setHeader('Content-Type', 'text/javascript');
	res.send(loader.Files['jquery.js']);
});

app.listen(8080);

console.log('Server listening @ 8080');



