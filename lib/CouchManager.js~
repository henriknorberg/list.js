var cc = require('./couchClient');

var manager = function(port,host,dbname)
{
	this.couchClient = new cc.Client(port,host,dbname);
	
	this.NewList = function(list, callback)
	{
		list.type = 'list';

		var json = JSON.stringify(list);
		this.couchClient.Insert(json, function(data)
		{
			if(callback)callback();
		});
	};
	
	this.GetListByName = function(lname, callback)
	{
		var cm = this;
		
		this.couchClient.CallView('lists', 'listnames', function(data)
		{

			console.log(data);
			data = JSON.parse(data);

			for(var i = 0; i < data.rows.length; i++)
			{
				var element = data.rows[i].doc;
				if(element.listname == lname)
				{
					callback(element);
					return;
				}
			}
			callback(null);
		});
	};
	
	this.GetDocuments = function(callback)
	{
		this.couchClient.GetAll(function(data)
		{
			data = JSON.parse(data);
		
			var docs = [];
			for(var i = 0; i < data.rows.length; i++)
			{
				docs[i] = data.rows[i].doc;
			}
			callback(docs);
		});
	};
	this.GetLists = function(callback)
	{
		this.couchClient.CallView('lists', 'lists', function(data)
		{
			data = JSON.parse(data);
			var lists = [];
			for(var i = 0; i < data.rows.length; i++)
			{
				lists[i] = data.rows[i].doc;
			}
			callback(lists);
		});
	};
};

exports.Manager = manager;
